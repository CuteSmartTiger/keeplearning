#### 使用集群的原因：
1. 并发量  OPS
一个节点的处理是10万每秒


2. 数据量
机器内存16-256G
业务需要500G



#### 数据分布
[可以参考的文章](https://blog.csdn.net/jy02268879/article/details/81488076)

- 顺序分区

- 哈希分区
1. 节点取余
哈希+取余
   是在客户端分片。优点简单。缺点：扩容影响太大。添加节点的时候整个数据会做很多偏移
。3个节点扩容添加1个节点，会发生80%的数据迁移。
    如果用这个中方式做数据分布，扩容的时候建议使用多倍扩容。比如3个节点，扩容的时候，再添加3个节点，这样只会发生50%的数据迁移。
   不建议使用这种古老的数据分布方式


2. 一致性性哈希
哈希+顺时针（优化取余）
原理，数据做成token环，为每一个节点分配一个token，key做了hash后会
落在两个node2之间，顺时针找离它最近的节点。是在客户端分片。节点比
较多的时候建议使用这种方式。节点伸缩的时候只影响临近的节点，
翻倍伸缩：还是要使用多倍扩容，不然会数据倾斜，保证最小数据迁移和负载均衡

3. 虚拟槽分区
这就是redis cluster使用的数据分布方式。
预设虚拟槽：每个槽映射一个数据子集，一般比节点数大。
由服务端管理节点、槽、数据的关系。

Redis虚拟槽分区的特点：
·解耦数据和节点之间的关系， 简化了节点扩容和收缩难度。
·节点自身维护槽的映射关系， 不需要客户端或者代理服务维护槽分区元数据。
·支持节点、 槽、 键之间的映射查询， 用于数据路由、 在线伸缩等场景。
数据分区是分布式存储的核心， 理解和灵活运用数据分区规则对于掌握Redis Cluster非常有帮助。

#### 集群功能限制
Redis集群相对单机在功能上存在一些限制， 需要开发人员提前了解，在使用时做好规避。 限制如下：
1） key批量操作支持有限。 如mset、 mget， 目前只支持具有相同slot值的key执行批量操作。 对于映射为不同slot值的key由于执行mget、 mget等操作可能存在于多个节点上因此不被支持。
2） key事务操作支持有限。 同理只支持多key在同一节点上的事务操作， 当多个key分布在不同的节点上时无法使用事务功能。
3） key作为数据分区的最小粒度， 因此不能将一个大的键值对象如hash、 list等映射到不同的节点。
4） 不支持多数据库空间。 单机下的Redis可以支持16个数据库， 集群模式下只能使用一个数据库空间， 即db0。
5） 复制结构只支持一层， 从节点只能复制主节点， 不支持嵌套树状复制结构。
