          前后端分离云管理平台开发及性能优化
Situation：云管理平台后台是基于flask框架开发，在Linux系统上运行，实现对用户创建、管理、资源分配等功能的云管理平台。
Task：参与云管理平台已有功能的前后端分离拆分，负责接口设计、文档的编写，负责事件管理(涉及MySQL事务)等新功能开发，参与远程调用XenAPI接口优化，负责需要并发的接口的优化，负责部分接口增加权限认证
Action：
基于RESTful思想设计接口，针对资源(URL指向的实体)定义一些列方法，进而针对资源进行操作，使用showdoc工具，基于markdown语法编写前后端交互的文档，使用token记录用户登录状态；
事件管理需要记录相关操作人员增、修、删的操作信息，需要一些列SQL要么执行成功要么不成功，即实现数据库事务，项目中定义父类及系列事件的方法，让需要被记录的model类继承父类，在子类增修删操作时调用父类方法，若失败则rollback回滚。
XenAPI接口接受较多参数，前后端分离后传入参数类型变化后导致远程调用XenAPI后没有结果，前期函数也没有备注参数类型，进入公司后，按照PEP8风格编写，对参数类型进行注解，并对参数使用instance进行判断，参数正确后再远程传参调用；
在保持内存、CPU、Nginx与uwsgi配置不变的情况下，针对接口进行优化，针对I/O操作，使用多线程编程，并指定最大线程数量，比如之前远程推送文件，两秒钟推送完成一个任务，改进后三秒左右可完成尽二十个任务，以前没有推送结果信息返回，使用可变对象字典作为共享变量，将推送成功与失败的对象及失败详细信息返回；针对查询，一则是使用sqlachemy中的join联表查询，将多次表查询尽可能的合成一次查询，二是多字段的查询，此时需要前后端交互文档中定义的参数名称与数据库中的字段保持一致，针对值不为空的键，使用Python的gettar获取字段，多次使用filter，最后统一查询；针对for循环，查阅资料将方法值话，减少属性查找的时间；
Result：编写开发文档，与前端协作，开发效率得到提高；实现对特定功能操作的监控；解决远程调用XenAPI接口失败的问题，并在公司推行代码检测，要求名称规范易懂，针对参数类型备注便宜维护与沟通，必要时进行参数类型检验；多线程将IO操作效率提高十倍以上；SQL语句查询优化，优化效率与查询对象数量有关，针对某一特定接口可以将查询时间从115ms优化到80ms时，吞吐率可以从约70提高到约100，提高了约40%，如果服务器与查询时间优化到极致，还需要进一步提高并发能力，则可以横向扩展，进行负载均衡。


掌握TCP UDP HTTP协议

              MySQL集群
Situation：实现MySQL数据库的高可用
Task：负责高可用方案的设计、测试验证、部署、升级，尽可能保证数据一致性
Action：欲用PXC实现高可用同时保证主从数据一致性，但是PXC不支持没有主键的表，故放弃此方案，然后设计双主一从，测试验证时使用percona-toolkit工具检测主从一致性，修改日志复制格式，由基于段改为基于行，最后定为基于混合模式进行主从复制，解决部分主键冲突的问题，后续发现IKYCenter服务的操作同时对主从进行写入导致主从主键冲突，则将双主多从改为一主多从，主从之间异步复制，同时将从设置为只读模式，由于root用户依然可以对只读数据库进行写操作，所以创建非root用户并授予相关操作的权限，解决了所有主从主键冲突的问题。当主数据库宕机后会出现主从数据不一致的情况，将MySQL从5.5版本升级到5.7版本，将异步复制改为半同步复制，设置AFTER_SYNC参数，提高主从一致性。主从延迟方面(待定)
Result：通过方案设计、数据库升级、参数配置实现了数据库的高可用，同时尽可能的保证了主从数据的一致，能够满足当前业务需求。
MySQL学习与工作整理的文档地址：https://github.com/Max-Liuhu/keeplearning/tree/master/MySQL







            windows平台运行程序的开发
Situation：VDImonitor是基于Python开发运行在客户windows系统上的程序。功能一是收集信息发送至管理平台所在的服务端并存储，功能二是实现开机检测更新或客户端人为确认更新后自动更新安装。
Task:我的工作内容一是负责开发实现开机或者客户端确认升级后检测是否需要更新与自动更新最新软件包的功能，二是参与开发收集Windows上软件与平台的信息。
Action:使用etcd收集Windows信息，定时向管理平台发送信息；升级方面：在管理平台定义两个接口，一个是获取是否需要升级及相关更新包的一系列信息，第二接口是当用户点击确认信息，通过这个接口向etcd中存入键值，Windows端的watch函数监听到对应的键值有更新则执行升级函数，使用多线程编程实现不同功能的同时运行，开发中归纳总结编写可复用代码，在多线调用相同函数时使用锁机制解决死锁问题，另外优化日志记录，增加记录线程编号，调试时方便识别出相同函数在不同线程中的异常，通过获取多线程的运行状态并定时输出日志，发现并解决程序正常运行然而某一线程异常停止的bug。
Result: 使用etcd实现高频的读写，多线程编程以及etcd中watch函数的使用完成两种情景升级功能的开发，通过日志优化，识别与解决了1个重大bug；




                etcd集群
Situation：etcd非关系型数据库的高可用
Task：利用etcd数据的一致性，选择etcd容器，部署高可用集群
Action：我的主要任务是参与etcd集群的部署，及部署文档的编写
Result：理解etcd数据一致性的原理，完成文档的编写





            云管理平台的部署及运维升级
Situation：基于docker容器部署项目，实现管平台高可用
Task：我的任务一是负责在现有的部署方式上进行优化与维护，云管理平台容器是以Nginx作为反向代理，uWSGI作为Web服务器，二是负责解决各容器日志与容器内部程序日志爆满的问题，三是负责实现管理平台的高可用，四是负责编写部署、升级文档与脚本；
Action：为提高程序对并发的支持，增加内存与CPU, 这时针对Nginx配置文件修改worker_processes参数，配置worker_rlimit_nofile最大打开数(与宿主机一致)，events模块配置worker_connections，单个后台worker process进程的最大并发链接数，uwsgi配置文件修改processes与threads参数的值；针对日志，将容器日志映射到宿主机指定目录下，然后使用Linux的定时任务进行切割压缩，修改容器配置文件设置容器日志最大值，防止动气日志爆满；使用keepalive，编写脚本对服务器相关进程监控，当进程出现异常时，虚拟IP漂移，使用tcpdump抓起广播，发现与同一网段下另一个集群组ID
一样，修改保证同一网段下集群组ID唯一，解决了集群运行一段时间异常的问题；学习shell，编写脚本，提高部署效率，同时编写部署、升级文档，方便测试与实施使用
Result：，将Nginx与uwsgi配置文件根据内存与CPU的增加修改后，支持的并发数几乎可以翻倍；实现日志集中化管理，并对日志定时切割压缩，再也没有日志爆满问题；管理平台实现高可用，文档与脚本的编写提高测试与实施的效率。
